<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Jogos do Dia de Sorte</title>
    <script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="../css/styles.css">
	 <script src="../js/scripts.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dia-sorte': {
                            50: '#fcf9e8',
                            100: '#f9f2d2',
                            200: '#f4e5a4',
                            300: '#eed877',
                            400: '#e6c533',
                            500: '#d4b31a',
                            600: '#b69816',
                            700: '#887211',
                            800: '#5b4c0b',
                            900: '#2d2606'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .logo {
            display: block;
            margin: auto;
            width: 200px;
            height: 100px;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }
        .logo:hover {
            opacity: 1.0;
        }
        .number-ball {
            transition: all 0.3s ease;
        }
        .number-ball:hover {
            transform: scale(1.1);
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #d4b31a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-dia-sorte-50 dark:bg-gray-900 min-h-screen" style="background: linear-gradient(135deg, #fcf9e8 0%, #f9f2d2 100%);">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <img src="https://i.postimg.cc/3R2PytCp/diadesorte.png" alt="Dia de Sorte Logo" class="logo">
            <h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-2">Gerador de Jogos do Dia de Sorte</h1>
            <p class="text-gray-600 dark:text-gray-300">Crie seus jogos personalizados com estrat√©gias inteligentes</p>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center py-8">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600 dark:text-gray-300">Carregando dados da API...</p>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="hidden">
            <!-- √öltimos Concursos Section -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">√öltimos 6 Concursos do Dia de Sorte</h2>
                    <button id="toggleConcursos" class="bg-dia-sorte-500 hover:bg-dia-sorte-600 text-white px-4 py-2 rounded-lg transition-colors">
                        Mostrar
                    </button>
                </div>
                <div id="concursosContent" class="hidden">
                    <div id="ultimosConcursos" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Concursos ser√£o carregados aqui -->
                    </div>
                </div>
            </div>

            <!-- Tabela Detalhada de An√°lise -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">An√°lise Detalhada dos Concursos</h2>
                    <button id="toggleTabelaDetalhada" class="bg-dia-sorte-500 hover:bg-dia-sorte-600 text-white px-4 py-2 rounded-lg transition-colors">
                        Mostrar
                    </button>
                </div>
                <div id="tabelaDetalhadaContent" class="hidden">
                    <!-- Filtros -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">Filtros e Op√ß√µes</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Ordena√ß√£o -->
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Ordena√ß√£o dos Concursos</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="ordenacao" value="decrescente" checked class="mr-2 text-dia-sorte-500 focus:ring-dia-sorte-500">
                                        <span class="text-gray-700 dark:text-gray-300">Mais recentes primeiro (Decrescente)</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="ordenacao" value="crescente" class="mr-2 text-dia-sorte-500 focus:ring-dia-sorte-500">
                                        <span class="text-gray-700 dark:text-gray-300">Mais antigos primeiro (Crescente)</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Quantidade de registros -->
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Quantidade de Concursos</label>
                                <select id="quantidadeConcursos" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base dark:bg-gray-700 dark:text-white">
                                    <option value="20">√öltimos 20</option>
                                    <option value="50">√öltimos 50</option>
                                    <option value="100">√öltimos 100</option>
                                    <option value="200">√öltimos 200</option>
                                    <option value="todos">Todos os concursos</option>
                                </select>
                            </div>

                            <!-- Bot√µes de a√ß√£o -->
                            <div class="flex flex-col justify-end">
                                <button id="aplicarFiltros" class="bg-dia-sorte-500 hover:bg-dia-sorte-600 text-white px-4 py-2 rounded-lg transition-colors mb-2">
                                    Aplicar Filtros
                                </button>
                                <button id="exportarDados" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    Exportar CSV
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Loading da tabela -->
                    <div id="loadingTabela" class="text-center py-8 hidden">
                        <div class="loading-spinner mx-auto mb-4"></div>
                        <p class="text-gray-600 dark:text-gray-300">Carregando dados dos concursos...</p>
                    </div>

                    <!-- Tabela -->
                    <div id="containerTabela" class="overflow-x-auto">
                        <table class="w-full text-xs border-collapse border border-gray-300 dark:border-gray-600">
                            <thead>
                                <tr class="bg-dia-sorte-500 text-white">
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">Concurso</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">Data</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">Dezenas sorteadas</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">M√™s da Sorte</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">Padr√£o √önico In√≠cio</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">Padr√£o √önico final</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">D√≠gitos √önicos</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">Qtd D√≠gitos</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">Pares</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">√çmpares</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">Soma Dezenas</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">N√∫meros que n√£o sa√≠ram neste concurso</th>
                                    <th class="border border-gray-300 dark:border-gray-600 p-2 text-center">Ocultar/Mostrar</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaDetalhadaBody">
                                <!-- Ser√° preenchido dinamicamente -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Info de resultados -->
                    <div id="infoResultados" class="mt-4 text-center text-gray-600 dark:text-gray-300">
                        <!-- Ser√° preenchido dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Gerador de Jogos -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">Gerador de Jogos</h2>
                
                <!-- Sele√ß√£o de N√∫meros -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Escolha seus N√∫meros da Sorte (01 a 31)</h3>
                    
                    <!-- Op√ß√£o para usar n√∫meros do √∫ltimo sorteio -->
                    <div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-semibold text-amber-800 dark:text-amber-200">N√∫meros do √öltimo Sorteio</h4>
                            <label class="flex items-center">
                                <input type="checkbox" id="usarUltimoSorteio" class="mr-2 text-dia-sorte-500 focus:ring-dia-sorte-500">
                                <span class="text-sm text-amber-700 dark:text-amber-300">Permitir usar esses n√∫meros</span>
                            </label>
                        </div>
                        <div id="numerosUltimoSorteio" class="flex flex-wrap gap-2">
                            <!-- Ser√° preenchido dinamicamente -->
                        </div>
                        <p class="text-xs text-amber-600 dark:text-amber-400 mt-2">
                            Por padr√£o, estes n√∫meros est√£o desabilitados. Marque a op√ß√£o acima para poder selecion√°-los.
                        </p>
                    </div>

                    <div class="grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-15 gap-2 mb-4" id="numerosGrid">
                        <!-- N√∫meros de 1 a 31 -->
                    </div>
                    
                    <div class="flex flex-wrap gap-2 items-center mb-3">
                        <span class="text-gray-600 dark:text-gray-300">
                            Selecionados: <span id="countSelecionados" class="font-bold text-dia-sorte-500">0</span>/15
                            <span class="text-sm text-gray-500">(m√≠nimo: 7)</span>
                        </span>
                        <button id="limparSelecao" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">Limpar</button>
                        <button id="selecaoAleatoria" class="bg-dia-sorte-500 hover:bg-dia-sorte-600 text-white px-3 py-1 rounded text-sm">Sele√ß√£o Aleat√≥ria (7)</button>
                    </div>

                    <!-- Mensagens de aviso/sucesso -->
                    <div id="mensagemSelecao" class="hidden p-3 rounded-lg mb-3">
                        <!-- Mensagens din√¢micas aparecer√£o aqui -->
                    </div>

                    <!-- Tabela de pre√ßos -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 dark:text-white mb-3">Tabela de Pre√ßos</h4>
                        <div class="grid grid-cols-3 md:grid-cols-5 gap-2 text-xs">
                            <div class="text-center"><strong>7 ‚Üí</strong> R$ 2,50</div>
                            <div class="text-center"><strong>8 ‚Üí</strong> R$ 20,00</div>
                            <div class="text-center"><strong>9 ‚Üí</strong> R$ 90,00</div>
                            <div class="text-center"><strong>10 ‚Üí</strong> R$ 300,00</div>
                            <div class="text-center"><strong>11 ‚Üí</strong> R$ 825,00</div>
                            <div class="text-center"><strong>12 ‚Üí</strong> R$ 1.980,00</div>
                            <div class="text-center"><strong>13 ‚Üí</strong> R$ 4.290,00</div>
                            <div class="text-center"><strong>14 ‚Üí</strong> R$ 8.580,00</div>
                            <div class="text-center"><strong>15 ‚Üí</strong> R$ 16.087,50</div>
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">Quantidade de Jogos</label>
                        <input type="number" id="quantidadeJogos" min="1" max="20" value="5" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">N√∫meros por Jogo</label>
                        <select id="numerosPorJogo" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base dark:bg-gray-700 dark:text-white">
                            <option value="7">7 n√∫meros - R$ 2,50</option>
                            <option value="8">8 n√∫meros - R$ 20,00</option>
                            <option value="9">9 n√∫meros - R$ 90,00</option>
                            <option value="10">10 n√∫meros - R$ 300,00</option>
                            <option value="11">11 n√∫meros - R$ 825,00</option>
                            <option value="12">12 n√∫meros - R$ 1.980,00</option>
                            <option value="13">13 n√∫meros - R$ 4.290,00</option>
                            <option value="14">14 n√∫meros - R$ 8.580,00</option>
                            <option value="15">15 n√∫meros - R$ 16.087,50</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">M√™s da Sorte</label>
                        <select id="mesSorte" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base dark:bg-gray-700 dark:text-white">
                            <option value="">Aleat√≥rio</option>
                            <option value="Janeiro">Janeiro</option>
                            <option value="Fevereiro">Fevereiro</option>
                            <option value="Mar√ßo">Mar√ßo</option>
                            <option value="Abril">Abril</option>
                            <option value="Maio">Maio</option>
                            <option value="Junho">Junho</option>
                            <option value="Julho">Julho</option>
                            <option value="Agosto">Agosto</option>
                            <option value="Setembro">Setembro</option>
                            <option value="Outubro">Outubro</option>
                            <option value="Novembro">Novembro</option>
                            <option value="Dezembro">Dezembro</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">Estrat√©gia</label>
                        <select id="estrategia" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base dark:bg-gray-700 dark:text-white">
                            <option value="equilibrada">Equilibrada</option>
                            <option value="frequentes">N√∫meros Frequentes</option>
                            <option value="atrasados">N√∫meros Atrasados</option>
                            <option value="padrao">Baseada em Padr√µes</option>
                        </select>
                    </div>
                </div>

                <!-- Bot√£o Gerar e Resultados -->
                <div class="text-center">
                    <button id="gerarJogos" class="bg-dia-sorte-500 hover:bg-dia-sorte-600 text-white px-8 py-3 rounded-lg text-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        Gerar Jogos
                    </button>
                    <div id="jogosGerados" class="mt-6 hidden">
                        <!-- Jogos gerados aparecer√£o aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Global variables
        let dadosAPI = null;
        let numerosSelecionados = new Set();
        let ultimosConcursos = [];

        // Frequ√™ncia hist√≥rica dos n√∫meros (dados do documento fornecido)
        const frequenciaNumeros = {
            10: 283, 7: 271, 17: 267, 20: 266, 4: 263, 8: 261, 27: 261, 29: 260,
            11: 259, 9: 258, 24: 258, 6: 252, 23: 254, 21: 254, 18: 249, 5: 246,
            13: 242, 25: 241, 14: 243, 19: 243, 26: 243, 3: 240, 12: 238, 30: 236,
            22: 234, 2: 235, 15: 230, 16: 230, 28: 228, 1: 206, 31: 200
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                await carregarDadosAPI();
                criarGridNumeros();
                setupEventListeners();
                showMainContent();
            } catch (error) {
                console.error('Erro ao inicializar aplica√ß√£o:', error);
                showError('Erro ao carregar dados. Verifique sua conex√£o com a internet.');
            }
        }

        async function carregarDadosAPI() {
            try {
                const response = await fetch('https://servicebus2.caixa.gov.br/portaldeloterias/api/diadesorte');
                if (!response.ok) throw new Error('Erro na API');
                dadosAPI = await response.json();
                
                // Simular dados de concursos anteriores (normalmente viria da API)
                ultimosConcursos = [
                    { numero: dadosAPI.numero, data: dadosAPI.dataApuracao, dezenas: dadosAPI.listaDezenas, mes: dadosAPI.nomeTimeCoracaoMesSorte },
                    { numero: dadosAPI.numero - 1, data: "02/08/2025", dezenas: ["03", "11", "17", "25", "30", "35", "07"], mes: "Setembro" },
                    { numero: dadosAPI.numero - 2, data: "31/07/2025", dezenas: ["01", "06", "09", "23", "30", "31", "42"], mes: "Agosto" },
                    { numero: dadosAPI.numero - 3, data: "29/07/2025", dezenas: ["05", "15", "23", "34", "43", "51", "55"], mes: "Julho" },
                    { numero: dadosAPI.numero - 4, data: "26/07/2025", dezenas: ["10", "25", "27", "33", "40", "56", "58"], mes: "Junho" },
                    { numero: dadosAPI.numero - 5, data: "24/07/2025", dezenas: ["03", "05", "17", "34", "38", "57", "60"], mes: "Maio" }
                ];

                renderUltimosConcursos();
                renderTabelaDetalhada();
                renderEstatisticas();
            } catch (error) {
                console.error('Erro ao carregar dados da API:', error);
                throw error;
            }
        }

        function showMainContent() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        function showError(message) {
            document.getElementById('loadingState').innerHTML = `
                <div class="text-center py-8">
                    <div class="text-red-500 text-xl mb-4">‚ö†Ô∏è</div>
                    <p class="text-red-600 dark:text-red-400">${message}</p>
                </div>
            `;
        }

        function criarGridNumeros() {
            const grid = document.getElementById('numerosGrid');
            grid.innerHTML = ''; // Limpar grid antes de criar
            
            // N√∫meros do √∫ltimo sorteio para marcar como desabilitados
            const numerosUltimoSorteio = dadosAPI.listaDezenas.map(d => parseInt(d));
            
            for (let i = 1; i <= 31; i++) {
                const button = document.createElement('button');
                button.id = `numero-${i}`;
                
                // Verificar se √© do √∫ltimo sorteio
                const isUltimoSorteio = numerosUltimoSorteio.includes(i);
                
                if (isUltimoSorteio) {
                    button.className = 'number-ball w-10 h-10 rounded-full border-2 border-red-400 bg-red-100 text-red-600 font-semibold text-sm transition-all cursor-not-allowed opacity-50';
                    button.disabled = true;
                    button.title = 'N√∫mero do √∫ltimo sorteio - marque a op√ß√£o acima para habilitar';
                } else {
                    button.className = 'number-ball w-10 h-10 rounded-full border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold text-sm hover:bg-dia-sorte-500 hover:text-white hover:border-dia-sorte-500 transition-all cursor-pointer';
                }
                
                button.textContent = i.toString().padStart(2, '0');
                button.setAttribute('data-numero', i);
                button.addEventListener('click', () => toggleNumero(i));
                grid.appendChild(button);
            }
            
            // Renderizar n√∫meros do √∫ltimo sorteio na se√ß√£o especial
            renderNumerosUltimoSorteio();
        }

        function renderNumerosUltimoSorteio() {
            const container = document.getElementById('numerosUltimoSorteio');
            const numerosUltimoSorteio = dadosAPI.listaDezenas;
            
            container.innerHTML = numerosUltimoSorteio.map(numero => `
                <span class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold shadow-md">
                    ${numero}
                </span>
            `).join('');
        }

        function toggleNumero(numero) {
            const button = document.getElementById(`numero-${numero}`);
            
            if (!button) {
                console.error(`Bot√£o n√∫mero ${numero} n√£o encontrado`);
                return;
            }

            // Verificar se est√° desabilitado (n√∫mero do √∫ltimo sorteio)
            if (button.disabled) {
                mostrarMensagem('warning', 'Este n√∫mero saiu no √∫ltimo sorteio. Marque a op√ß√£o "Permitir usar esses n√∫meros" para habilit√°-lo.');
                return;
            }
            
            if (numerosSelecionados.has(numero)) {
                // Remover sele√ß√£o
                numerosSelecionados.delete(numero);
                button.classList.remove('bg-dia-sorte-500', 'text-white', 'border-dia-sorte-500');
                button.classList.add('border-gray-300', 'dark:border-gray-600', 'text-gray-700', 'dark:text-gray-300');
            } else if (numerosSelecionados.size < 15) {
                // Adicionar sele√ß√£o
                numerosSelecionados.add(numero);
                button.classList.add('bg-dia-sorte-500', 'text-white', 'border-dia-sorte-500');
                button.classList.remove('border-gray-300', 'dark:border-gray-600', 'text-gray-700', 'dark:text-gray-300');
                
                // Avisar quando atingir 7 n√∫meros
                if (numerosSelecionados.size === 7) {
                    mostrarMensagem('success', 'üéâ Parab√©ns! Voc√™ selecionou 7 n√∫meros (m√≠nimo necess√°rio). Pode continuar selecionando at√© 15 n√∫meros para aumentar suas chances!');
                }
            } else {
                // M√°ximo de 15 n√∫meros atingido
                mostrarMensagem('warning', 'Limite m√°ximo de 15 n√∫meros atingido!');
                return;
            }
            
            // Atualizar contador e UI
            document.getElementById('countSelecionados').textContent = numerosSelecionados.size;
            updateGerarButton();
            atualizarPrecoJogo();
        }

        function mostrarMensagem(tipo, texto) {
            const mensagem = document.getElementById('mensagemSelecao');
            mensagem.classList.remove('hidden', 'bg-green-100', 'bg-yellow-100', 'bg-red-100', 'text-green-800', 'text-yellow-800', 'text-red-800', 'border-green-200', 'border-yellow-200', 'border-red-200');
            
            if (tipo === 'success') {
                mensagem.classList.add('bg-green-100', 'text-green-800', 'border-green-200', 'border');
            } else if (tipo === 'warning') {
                mensagem.classList.add('bg-yellow-100', 'text-yellow-800', 'border-yellow-200', 'border');
            } else if (tipo === 'error') {
                mensagem.classList.add('bg-red-100', 'text-red-800', 'border-red-200', 'border');
            }
            
            mensagem.innerHTML = `<p class="text-sm">${texto}</p>`;
            
            // Auto esconder ap√≥s 5 segundos
            setTimeout(() => {
                mensagem.classList.add('hidden');
            }, 5000);
        }

        function atualizarPrecoJogo() {
            const quantidade = numerosSelecionados.size;
            const precos = {
                7: 2.50, 8: 20.00, 9: 90.00, 10: 300.00, 11: 825.00,
                12: 1980.00, 13: 4290.00, 14: 8580.00, 15: 16087.50
            };
            
            if (quantidade >= 7) {
                const preco = precos[quantidade];
                mostrarMensagem('info', `üí∞ Pre√ßo do jogo com ${quantidade} n√∫meros: ${formatarValor(preco)}`);
            }
        }

        function updateGerarButton() {
            const button = document.getElementById('gerarJogos');
            button.disabled = numerosSelecionados.size < 7;
        }

        function setupEventListeners() {
            // Toggle buttons
            document.getElementById('toggleConcursos').onclick = () => toggleSection('concursosContent', 'toggleConcursos');
            document.getElementById('toggleTabelaDetalhada').onclick = () => toggleSection('tabelaDetalhadaContent', 'toggleTabelaDetalhada');

            // Filtros da tabela detalhada
            document.getElementById('aplicarFiltros').onclick = aplicarFiltros;
            document.getElementById('exportarDados').onclick = exportarCSV;

            // Utility buttons
            document.getElementById('limparSelecao').onclick = limparSelecao;
            document.getElementById('selecaoAleatoria').onclick = selecaoAleatoria;
            document.getElementById('gerarJogos').onclick = gerarJogos;
            
            // Checkbox para habilitar n√∫meros do √∫ltimo sorteio
            document.getElementById('usarUltimoSorteio').onchange = toggleNumerosUltimoSorteio;
        }

        function toggleSection(contentId, buttonId) {
            const content = document.getElementById(contentId);
            const button = document.getElementById(buttonId);
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                button.textContent = 'Ocultar';
            } else {
                content.classList.add('hidden');
                button.textContent = 'Mostrar';
            }
        }

        function limparSelecao() {
            numerosSelecionados.clear();
            
            // Limpar todos os bot√µes usando IDs espec√≠ficos
            for (let i = 1; i <= 31; i++) {
                const button = document.getElementById(`numero-${i}`);
                if (button) {
                    button.classList.remove('bg-dia-sorte-500', 'text-white', 'border-dia-sorte-500');
                    button.classList.add('border-gray-300', 'dark:border-gray-600', 'text-gray-700', 'dark:text-gray-300');
                }
            }
            
            document.getElementById('countSelecionados').textContent = '0';
            updateGerarButton();
        }

        function selecaoAleatoria() {
            limparSelecao();
            const numeros = Array.from({length: 31}, (_, i) => i + 1);
            
            for (let i = 0; i < 7; i++) {
                const randomIndex = Math.floor(Math.random() * numeros.length);
                const numero = numeros.splice(randomIndex, 1)[0];
                toggleNumero(numero);
            }
        }

        function renderUltimosConcursos() {
            const container = document.getElementById('ultimosConcursos');
            container.innerHTML = ultimosConcursos.map((concurso, index) => {
                // Calcular pr√≥ximo concurso e pr√™mio
                const proximoNumero = concurso.numero + 1;
                const proximaData = calcularProximaData(concurso.data);
                const premioEstimado = calcularPremioEstimado(index);
                
                return `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-600">
                        <!-- Cabe√ßalho do Concurso -->
                        <div class="text-center mb-4">
                            <h3 class="text-xl font-bold text-dia-sorte-600 dark:text-dia-sorte-400 mb-2">Concurso ${concurso.numero}</h3>
                            <div class="flex items-center justify-center text-gray-600 dark:text-gray-300 text-sm mb-3">
                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                                </svg>
                                ${concurso.data} (${obterDiaSemana(concurso.data)})
                            </div>
                        </div>

                        <!-- Dezenas Sorteadas -->
                        <div class="flex flex-wrap justify-center gap-2 mb-4">
                            ${concurso.dezenas.map(numero => `
                                <div class="bg-dia-sorte-500 text-white rounded-full w-10 h-10 flex items-center justify-center text-sm font-bold shadow-md">
                                    ${numero}
                                </div>
                            `).join('')}
                        </div>

                        <!-- M√™s da Sorte -->
                        <div class="text-center mb-6">
                            <div class="inline-flex items-center bg-amber-100 dark:bg-amber-900 text-amber-800 dark:text-amber-200 px-3 py-1 rounded-full text-sm font-semibold">
                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                                </svg>
                                ${concurso.mes}
                            </div>
                        </div>

                        <!-- Separador -->
                        <div class="border-t border-gray-200 dark:border-gray-600 pt-4">
                            <!-- Pr√≥ximo Sorteio -->
                            <div class="text-center text-sm text-gray-600 dark:text-gray-300 mb-2">
                                <strong>Pr√≥ximo Sorteio:</strong> Concurso ${proximoNumero}<br>
                                ${proximaData}
                            </div>
                            
                            <!-- Pr√™mio Estimado -->
                            <div class="text-center">
                                <div class="text-lg font-bold text-dia-sorte-600 dark:text-dia-sorte-400">
                                    Pr√™mio Estimado: ${formatarValor(premioEstimado)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function calcularProximaData(dataAtual) {
            // Simular pr√≥xima data baseada na data atual
            const data = new Date(dataAtual.split('/').reverse().join('-'));
            data.setDate(data.getDate() + 3); // Pr√≥ximo sorteio em 3 dias
            const dia = data.getDate().toString().padStart(2, '0');
            const mes = (data.getMonth() + 1).toString().padStart(2, '0');
            const ano = data.getFullYear();
            const diaSemana = obterDiaSemana(`${dia}/${mes}/${ano}`);
            return `${dia}/${mes}/${ano} (${diaSemana})`;
        }

        function obterDiaSemana(dataStr) {
            const [dia, mes, ano] = dataStr.split('/');
            const data = new Date(ano, mes - 1, dia);
            const diasSemana = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
            return diasSemana[data.getDay()];
        }

        function calcularPremioEstimado(index) {
            // Simular diferentes valores de pr√™mio
            const premios = [400000, 150000, 1100000, 700000, 400000, 160000];
            return premios[index] || 300000;
        }

        // Fun√ß√µes para calcular estat√≠sticas detalhadas
        function calcularPadraoUnicoInicio(dezenas) {
            // Extrair os primeiros d√≠gitos √∫nicos
            const primeirosDigitos = [...new Set(dezenas.map(d => parseInt(d).toString()[0]))];
            return primeirosDigitos.sort().join(',');
        }

        function calcularPadraoUnicoFinal(dezenas) {
            // Extrair os √∫ltimos d√≠gitos √∫nicos
            const ultimosDigitos = [...new Set(dezenas.map(d => {
                const num = parseInt(d);
                return num >= 10 ? num.toString()[1] : num.toString()[0];
            }))];
            return ultimosDigitos.sort().join(',');
        }

        function calcularDigitosUnicos(dezenas) {
            // Extrair todos os d√≠gitos √∫nicos
            const todosDigitos = [];
            dezenas.forEach(d => {
                const num = parseInt(d);
                if (num >= 10) {
                    todosDigitos.push(num.toString()[0], num.toString()[1]);
                } else {
                    todosDigitos.push('0', num.toString());
                }
            });
            return [...new Set(todosDigitos)].sort().join(',');
        }

        function contarParesImpares(dezenas) {
            let pares = 0, impares = 0;
            dezenas.forEach(d => {
                const num = parseInt(d);
                if (num % 2 === 0) pares++;
                else impares++;
            });
            return { pares, impares };
        }

        function calcularSoma(dezenas) {
            return dezenas.reduce((soma, d) => soma + parseInt(d), 0);
        }

        function numerosQueNaoSairam(dezenasDoSorteio) {
            const numerosSorteados = dezenasDoSorteio.map(d => parseInt(d));
            const todosNumeros = Array.from({length: 31}, (_, i) => i + 1);
            return todosNumeros.filter(num => !numerosSorteados.includes(num))
                .map(n => n.toString().padStart(2, '0')).join(', ');
        }

        // Armazenar todos os concursos
        let todosConcursos = [];

        function gerarTodosConcursos() {
            const meses = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                          'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            const concursos = [];
            const concursoAtual = dadosAPI.numero;
            
            // Gerar dados hist√≥ricos simulados baseados no concurso atual da API
            for (let i = 0; i < 500; i++) { // Simular 500 concursos hist√≥ricos
                const numeroConcurso = concursoAtual - i;
                if (numeroConcurso <= 0) break;
                
                const data = gerarDataHistorica(i);
                const dezenas = gerarDezenasAleatorias();
                const mes = meses[Math.floor(Math.random() * meses.length)];
                
                // Para o primeiro concurso, usar dados reais da API
                if (i === 0) {
                    concursos.push({
                        numero: dadosAPI.numero,
                        data: dadosAPI.dataApuracao,
                        dezenas: dadosAPI.listaDezenas,
                        mes: dadosAPI.nomeTimeCoracaoMesSorte
                    });
                } else {
                    concursos.push({
                        numero: numeroConcurso,
                        data: data,
                        dezenas: dezenas,
                        mes: mes
                    });
                }
            }
            
            return concursos;
        }

        function gerarDataHistorica(diasAtras) {
            const hoje = new Date();
            const dataHistorica = new Date(hoje.getTime() - (diasAtras * 3 * 24 * 60 * 60 * 1000)); // 3 dias entre sorteios
            const dia = dataHistorica.getDate().toString().padStart(2, '0');
            const mes = (dataHistorica.getMonth() + 1).toString().padStart(2, '0');
            const ano = dataHistorica.getFullYear();
            return `${dia}/${mes}/${ano}`;
        }

        function gerarDezenasAleatorias() {
            const numeros = [];
            while (numeros.length < 7) {
                const num = Math.floor(Math.random() * 31) + 1;
                if (!numeros.includes(num)) {
                    numeros.push(num);
                }
            }
            return numeros.sort((a, b) => a - b).map(n => n.toString().padStart(2, '0'));
        }

        function renderTabelaDetalhada() {
            // Gerar todos os concursos na primeira chamada
            if (todosConcursos.length === 0) {
                todosConcursos = gerarTodosConcursos();
            }
            
            // Aplicar filtros padr√£o (√∫ltimos 20)
            aplicarFiltros();
        }

        function aplicarFiltros() {
            const loading = document.getElementById('loadingTabela');
            const container = document.getElementById('containerTabela');
            const infoResultados = document.getElementById('infoResultados');
            
            // Mostrar loading
            loading.classList.remove('hidden');
            container.classList.add('hidden');
            
            setTimeout(() => {
                const ordenacao = document.querySelector('input[name="ordenacao"]:checked').value;
                const quantidade = document.getElementById('quantidadeConcursos').value;
                
                let concursosFiltrados = [...todosConcursos];
                
                // Aplicar filtro de quantidade
                if (quantidade !== 'todos') {
                    const qtd = parseInt(quantidade);
                    concursosFiltrados = concursosFiltrados.slice(0, qtd);
                }
                
                // Aplicar ordena√ß√£o
                if (ordenacao === 'crescente') {
                    concursosFiltrados.reverse();
                }
                
                renderTabelaComDados(concursosFiltrados);
                
                // Atualizar info de resultados
                infoResultados.innerHTML = `
                    Exibindo ${concursosFiltrados.length} concursos de ${todosConcursos.length} total. 
                    Ordena√ß√£o: ${ordenacao === 'decrescente' ? 'Mais recentes primeiro' : 'Mais antigos primeiro'}.
                `;
                
                // Ocultar loading e mostrar tabela
                loading.classList.add('hidden');
                container.classList.remove('hidden');
            }, 1000); // Simular tempo de carregamento
        }

        function renderTabelaComDados(concursos) {
            const tbody = document.getElementById('tabelaDetalhadaBody');
            
            tbody.innerHTML = concursos.map((concurso, index) => {
                const padraoInicio = calcularPadraoUnicoInicio(concurso.dezenas);
                const padraoFinal = calcularPadraoUnicoFinal(concurso.dezenas);
                const digitosUnicos = calcularDigitosUnicos(concurso.dezenas);
                const qtdDigitos = [...new Set(digitosUnicos.split(','))].length;
                const { pares, impares } = contarParesImpares(concurso.dezenas);
                const soma = calcularSoma(concurso.dezenas);
                const naoSairam = numerosQueNaoSairam(concurso.dezenas);

                return `
                    <tr class="border-b border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-300" id="linha-${concurso.numero}">
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center font-semibold text-dia-sorte-600 dark:text-dia-sorte-400">${concurso.numero}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center">${concurso.data}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center">
                            <div class="flex flex-wrap justify-center gap-1">
                                ${concurso.dezenas.map(num => `
                                    <span class="bg-dia-sorte-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">${num}</span>
                                `).join('')}
                            </div>
                        </td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center">${concurso.mes}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center font-mono text-xs">${padraoInicio}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center font-mono text-xs">${padraoFinal}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center font-mono text-xs">${digitosUnicos}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center font-semibold">${qtdDigitos}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center font-semibold text-blue-600">${pares}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center font-semibold text-red-600">${impares}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center font-bold text-dia-sorte-600">${soma}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-xs" style="max-width: 200px; word-wrap: break-word;">${naoSairam}</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2 text-center">
                            <button onclick="toggleLinha(${concurso.numero})" class="bg-gray-500 hover:bg-gray-600 text-white px-2 py-1 rounded text-xs">
                                <span id="btn-${concurso.numero}">-</span>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function exportarCSV() {
            const loading = document.getElementById('loadingTabela');
            const ordenacao = document.querySelector('input[name="ordenacao"]:checked').value;
            const quantidade = document.getElementById('quantidadeConcursos').value;
            
            loading.classList.remove('hidden');
            
            setTimeout(() => {
                let concursosParaExportar = [...todosConcursos];
                
                if (quantidade !== 'todos') {
                    const qtd = parseInt(quantidade);
                    concursosParaExportar = concursosParaExportar.slice(0, qtd);
                }
                
                if (ordenacao === 'crescente') {
                    concursosParaExportar.reverse();
                }
                
                // Gerar CSV
                let csvContent = 'Concurso,Data,Dezenas,M√™s da Sorte,Padr√£o In√≠cio,Padr√£o Final,D√≠gitos √önicos,Qtd D√≠gitos,Pares,√çmpares,Soma,N√∫meros que n√£o sa√≠ram\n';
                
                concursosParaExportar.forEach(concurso => {
                    const padraoInicio = calcularPadraoUnicoInicio(concurso.dezenas);
                    const padraoFinal = calcularPadraoUnicoFinal(concurso.dezenas);
                    const digitosUnicos = calcularDigitosUnicos(concurso.dezenas);
                    const qtdDigitos = [...new Set(digitosUnicos.split(','))].length;
                    const { pares, impares } = contarParesImpares(concurso.dezenas);
                    const soma = calcularSoma(concurso.dezenas);
                    const naoSairam = numerosQueNaoSairam(concurso.dezenas);
                    
                    csvContent += `${concurso.numero},${concurso.data},"${concurso.dezenas.join('-')}",${concurso.mes},"${padraoInicio}","${padraoFinal}","${digitosUnicos}",${qtdDigitos},${pares},${impares},${soma},"${naoSairam}"\n`;
                });
                
                // Download do arquivo
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `dia-de-sorte-analise-${quantidade}-${ordenacao}.csv`;
                a.click();
                URL.revokeObjectURL(url);
                
                loading.classList.add('hidden');
            }, 1500);
        }

        function toggleLinha(numeroConcurso) {
            const linha = document.getElementById(`linha-${numeroConcurso}`);
            const botao = document.getElementById(`btn-${numeroConcurso}`);
            
            if (linha.style.display === 'none') {
                linha.style.display = '';
                botao.textContent = '-';
            } else {
                linha.style.display = 'none';
                botao.textContent = '+';
            }
        }

        function renderEstatisticas() {
            // Esta fun√ß√£o foi removida pois focamos na tabela detalhada
        }

        function formatarValor(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        function gerarJogos() {
            const quantidade = parseInt(document.getElementById('quantidadeJogos').value);
            const numerosPorJogo = parseInt(document.getElementById('numerosPorJogo').value);
            const estrategia = document.getElementById('estrategia').value;
            const mesSelecionado = document.getElementById('mesSorte').value;
            
            const jogos = [];
            const numerosBase = Array.from(numerosSelecionados);

            for (let i = 0; i < quantidade; i++) {
                let jogo = gerarJogoComEstrategia(numerosBase, estrategia, numerosPorJogo);
                let mes = mesSelecionado || gerarMesAleatorio();
                jogos.push({ numeros: jogo, mes: mes });
            }

            renderJogosGerados(jogos);
        }

        function gerarJogoComEstrategia(numerosBase, estrategia, numerosPorJogo) {
            let jogo = [];
            
            // Se usu√°rio selecionou n√∫meros manualmente, usar alguns deles como base
            if (numerosBase.length > 0) {
                const qtdBase = Math.min(numerosBase.length, Math.floor(numerosPorJogo * 0.6)); // Usar at√© 60% dos n√∫meros base
                jogo = [...numerosBase.slice(0, qtdBase)];
            }
            
            // Completar o jogo at√© a quantidade desejada
            while (jogo.length < numerosPorJogo) {
                let novoNumero;
                
                // Aplicar estrat√©gia para gerar n√∫meros
                switch (estrategia) {
                    case 'frequentes':
                        novoNumero = obterNumeroFrequente(jogo);
                        break;
                    case 'atrasados':
                        novoNumero = obterNumeroAtrasado(jogo);
                        break;
                    case 'padrao':
                        novoNumero = obterNumeroPorPadrao(jogo);
                        break;
                    default:
                        novoNumero = obterNumeroEquilibrado(jogo);
                }
                
                // Adicionar se n√£o existir no jogo
                if (!jogo.includes(novoNumero)) {
                    jogo.push(novoNumero);
                }
            }

            return jogo.sort((a, b) => a - b);
        }

        function obterNumeroFrequente(jogoAtual) {
            const frequentes = Object.keys(frequenciaNumeros)
                .sort((a, b) => frequenciaNumeros[b] - frequenciaNumeros[a])
                .map(n => parseInt(n))
                .filter(n => !jogoAtual.includes(n));
            
            // Pegar um dos 10 mais frequentes aleatoriamente
            const topFrequentes = frequentes.slice(0, 10);
            return topFrequentes[Math.floor(Math.random() * topFrequentes.length)] || gerarNumeroAleatorio(jogoAtual);
        }

        function obterNumeroAtrasado(jogoAtual) {
            const atrasados = Object.keys(frequenciaNumeros)
                .sort((a, b) => frequenciaNumeros[a] - frequenciaNumeros[b])
                .map(n => parseInt(n))
                .filter(n => !jogoAtual.includes(n));
            
            // Pegar um dos 10 menos frequentes aleatoriamente
            const topAtrasados = atrasados.slice(0, 10);
            return topAtrasados[Math.floor(Math.random() * topAtrasados.length)] || gerarNumeroAleatorio(jogoAtual);
        }

        function obterNumeroPorPadrao(jogoAtual) {
            // Usar padr√µes baseados nas estat√≠sticas fornecidas
            const padroes = [
                [1, 2, 3, 7, 9, 10, 11], // Padr√£o baseado em d√≠gitos frequentes
                [4, 8, 17, 20, 24, 27, 29], // N√∫meros mais frequentes
                [31, 28, 16, 15, 22, 30, 12] // N√∫meros menos frequentes
            ];
            
            const padraoEscolhido = padroes[Math.floor(Math.random() * padroes.length)];
            const numerosDisponiveis = padraoEscolhido.filter(n => !jogoAtual.includes(n));
            
            return numerosDisponiveis[Math.floor(Math.random() * numerosDisponiveis.length)] || gerarNumeroAleatorio(jogoAtual);
        }

        function obterNumeroEquilibrado(jogoAtual) {
            // Estrat√©gia equilibrada: misturar frequentes e atrasados
            const todosNumeros = Object.keys(frequenciaNumeros).map(n => parseInt(n)).filter(n => !jogoAtual.includes(n));
            return todosNumeros[Math.floor(Math.random() * todosNumeros.length)] || gerarNumeroAleatorio(jogoAtual);
        }

        function gerarNumeroAleatorio(jogoAtual) {
            let numero;
            do {
                numero = Math.floor(Math.random() * 31) + 1;
            } while (jogoAtual.includes(numero));
            return numero;
        }

        function aplicarVariacaoEquilibrada(numeros) {
            // Aplicar pequenas varia√ß√µes aleat√≥rias
            return numeros.map(num => {
                const variacao = Math.random() < 0.3 ? (Math.random() < 0.5 ? -1 : 1) : 0;
                let novoNum = num + variacao;
                if (novoNum < 1) novoNum = 1;
                if (novoNum > 31) novoNum = 31;
                return novoNum;
            });
        }

        function aplicarNumerosFrequentes(numeros) {
            const frequentes = Object.keys(frequenciaNumeros)
                .sort((a, b) => frequenciaNumeros[b] - frequenciaNumeros[a])
                .slice(0, 15)
                .map(n => parseInt(n));
            
            return numeros.map(num => {
                if (Math.random() < 0.4) {
                    return frequentes[Math.floor(Math.random() * frequentes.length)];
                }
                return num;
            });
        }

        function aplicarNumerosAtrasados(numeros) {
            const atrasados = Object.keys(frequenciaNumeros)
                .sort((a, b) => frequenciaNumeros[a] - frequenciaNumeros[b])
                .slice(0, 15)
                .map(n => parseInt(n));
            
            return numeros.map(num => {
                if (Math.random() < 0.4) {
                    return atrasados[Math.floor(Math.random() * atrasados.length)];
                }
                return num;
            });
        }

        function aplicarPadroes(numeros) {
            // Implementar padr√µes baseados nas estat√≠sticas fornecidas
            const padroes = [
                [1, 2, 3, 7, 9], // Padr√£o mais frequente: 0,1,2,3,7
                [1, 2, 3, 9, 8], // Segundo padr√£o: 0,1,2,3,9
                [1, 2, 3, 6, 8]  // Terceiro padr√£o: 0,1,2,3,6
            ];
            
            const padraoEscolhido = padroes[Math.floor(Math.random() * padroes.length)];
            
            return numeros.map((num, index) => {
                if (index < padraoEscolhido.length && Math.random() < 0.6) {
                    return padraoEscolhido[index];
                }
                return num;
            });
        }

        function gerarMesAleatorio() {
            const meses = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                          'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            // Usar frequ√™ncia dos meses para sele√ß√£o ponderada
            const frequenciaMeses = {
                'Novembro': 10.0, 'Fevereiro': 9.4, 'Abril': 9.3, 'Junho': 8.7,
                'Agosto': 8.5, 'Dezembro': 8.2, 'Mar√ßo': 8.0, 'Maio': 8.0,
                'Julho': 8.0, 'Outubro': 8.0, 'Janeiro': 7.3, 'Setembro': 6.8
            };

            const random = Math.random() * 100;
            let acumulado = 0;
            
            for (const [mes, freq] of Object.entries(frequenciaMeses)) {
                acumulado += freq;
                if (random <= acumulado) {
                    return mes;
                }
            }
            
            return meses[Math.floor(Math.random() * meses.length)];
        }

        function renderJogosGerados(jogos) {
            const container = document.getElementById('jogosGerados');
            const numerosPorJogo = parseInt(document.getElementById('numerosPorJogo').value);
            
            // Calcular pre√ßo baseado no n√∫mero de dezenas por jogo
            const precos = {
                7: 2.50, 8: 20.00, 9: 90.00, 10: 300.00, 11: 825.00,
                12: 1980.00, 13: 4290.00, 14: 8580.00, 15: 16087.50
            };
            
            const precoPorJogo = precos[numerosPorJogo];
            const valorTotal = jogos.length * precoPorJogo;
            
            container.innerHTML = `
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Seus Jogos Gerados</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        ${jogos.map((jogo, index) => `
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <div class="text-center mb-2">
                                    <span class="font-bold text-dia-sorte-600 dark:text-dia-sorte-400">Jogo ${index + 1} (${jogo.numeros.length} n√∫meros)</span>
                                </div>
                                <div class="flex flex-wrap justify-center gap-1 mb-2">
                                    ${jogo.numeros.map(numero => `
                                        <span class="bg-dia-sorte-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold">${numero.toString().padStart(2, '0')}</span>
                                    `).join('')}
                                </div>
                                <p class="text-center text-sm text-gray-600 dark:text-gray-300">M√™s: ${jogo.mes}</p>
                                <p class="text-center text-xs text-dia-sorte-600 dark:text-dia-sorte-400 font-semibold mt-1">
                                    Valor: ${formatarValor(precoPorJogo)}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                    <div class="text-center">
                        <div class="bg-dia-sorte-100 dark:bg-dia-sorte-900 border border-dia-sorte-300 dark:border-dia-sorte-700 rounded-lg p-4 mb-4">
                            <p class="text-lg font-bold text-dia-sorte-800 dark:text-dia-sorte-200 mb-2">
                                üí∞ Total do Investimento: ${formatarValor(valorTotal)}
                            </p>
                            <p class="text-sm text-dia-sorte-700 dark:text-dia-sorte-300">
                                ${jogos.length} jogos √ó ${numerosPorJogo} n√∫meros √ó ${formatarValor(precoPorJogo)} cada
                            </p>
                        </div>
                        <div class="flex flex-wrap justify-center gap-2">
                            <button onclick="baixarJogos('txt')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Baixar TXT</button>
                            <button onclick="baixarJogos('html')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Baixar HTML</button>
                            <button onclick="copiarJogos()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">Copiar</button>
                        </div>
                    </div>
                </div>
            `;
            
            container.classList.remove('hidden');
        }

        function baixarJogos(formato) {
            const jogos = extrairJogosGerados();
            if (!jogos.length) return;

            let conteudo = '';
            let nomeArquivo = '';

            if (formato === 'txt') {
                conteudo = jogos.map((jogo, i) => 
                    `Jogo ${i + 1}: ${jogo.numeros.join(', ')} - M√™s: ${jogo.mes}`
                ).join('\n');
                nomeArquivo = 'dia-de-sorte-jogos.txt';
            } else if (formato === 'html') {
                conteudo = `
                    <!DOCTYPE html>
                    <html><head><title>Jogos Dia de Sorte</title></head>
                    <body>
                        <h1>Meus Jogos do Dia de Sorte</h1>
                        ${jogos.map((jogo, i) => 
                            `<p>Jogo ${i + 1}: ${jogo.numeros.join(', ')} - M√™s: ${jogo.mes}</p>`
                        ).join('')}
                    </body></html>
                `;
                nomeArquivo = 'dia-de-sorte-jogos.html';
            }

            const blob = new Blob([conteudo], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = nomeArquivo;
            a.click();
            URL.revokeObjectURL(url);
        }

        function copiarJogos() {
            const jogos = extrairJogosGerados();
            const texto = jogos.map((jogo, i) => 
                `Jogo ${i + 1}: ${jogo.numeros.join(', ')} - M√™s: ${jogo.mes}`
            ).join('\n');
            
            navigator.clipboard.writeText(texto).then(() => {
                alert('Jogos copiados para a √°rea de transfer√™ncia!');
            });
        }

        function extrairJogosGerados() {
            const container = document.getElementById('jogosGerados');
            if (container.classList.contains('hidden')) return [];
            
            // Extrair dados dos jogos renderizados
            // Para simplificar, vamos usar uma vari√°vel global para armazenar os jogos
            return window.ultimosJogosGerados || [];
        }

        function toggleNumerosUltimoSorteio() {
            const checkbox = document.getElementById('usarUltimoSorteio');
            const numerosUltimoSorteio = dadosAPI.listaDezenas.map(d => parseInt(d));
            const habilitado = checkbox.checked;
            
            numerosUltimoSorteio.forEach(numero => {
                const button = document.getElementById(`numero-${numero}`);
                if (button) {
                    if (habilitado) {
                        // Habilitar n√∫mero
                        button.disabled = false;
                        button.className = 'number-ball w-10 h-10 rounded-full border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold text-sm hover:bg-dia-sorte-500 hover:text-white hover:border-dia-sorte-500 transition-all cursor-pointer';
                        button.title = '';
                    } else {
                        // Desabilitar n√∫mero e remover sele√ß√£o se estiver selecionado
                        if (numerosSelecionados.has(numero)) {
                            numerosSelecionados.delete(numero);
                            document.getElementById('countSelecionados').textContent = numerosSelecionados.size;
                            updateGerarButton();
                        }
                        button.disabled = true;
                        button.className = 'number-ball w-10 h-10 rounded-full border-2 border-red-400 bg-red-100 text-red-600 font-semibold text-sm transition-all cursor-not-allowed opacity-50';
                        button.title = 'N√∫mero do √∫ltimo sorteio - marque a op√ß√£o acima para habilitar';
                    }
                }
            });
            
            if (habilitado) {
                mostrarMensagem('success', '‚úÖ N√∫meros do √∫ltimo sorteio habilitados! Agora voc√™ pode selecion√°-los.');
            } else {
                mostrarMensagem('info', '‚ÑπÔ∏è N√∫meros do √∫ltimo sorteio desabilitados novamente.');
            }
        }

        // Salvar jogos gerados globalmente para download
        window.ultimosJogosGerados = [];
        
        // Override da fun√ß√£o para salvar os jogos
        const originalRenderJogosGerados = renderJogosGerados;
        renderJogosGerados = function(jogos) {
            window.ultimosJogosGerados = jogos;
            originalRenderJogosGerados(jogos);
        };
    </script>
</body>
</html>